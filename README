HTML page components
~~~~~~~~~~~~~~~~~~~~

* Files

The |src/page-components.js| file implements elements described in
this document.

The |css/default.css| file describes the default style for these
elements.  Though the file itself is not required to be loaded itself,
some of style rules in the file are effectively required for these
elements rendered as intended.

  <link rel=stylesheet href=css/default.css>
  <script src=src/page-components.js async></script>

* <button is=command-button>

A |button| element whose |is| attribute value is |command-button|
represents a command button.  (Be aware that this implementation does
not support mutation of |is| attribute; it must be set to a value
before the element's insertion into the document.)

The element must has a |data-selector| attribute.  Its value is a
group of selectors that selects an element in the document.

The element must has a |data-command| attribute whose value is the
name of the command.

When the element is clicked, the command specified by the
|data-command| attribute value of the element selected by the
|data-selector| attribute value is invoked.

A command whose name is /name/ for element /element/ can be defined by
setting these two values:

  element.cbCommands[name]   An object.  It can have any property.
  element[name]  A function.  This is the method implementing the command.

* <image-editor>

An |image-editor| element represents an image editor.

An element has *base image* and *overlay image*.  They are initially
transparent images.  The base image is represented by a |canvas|
element child with the class |base|.  The overlay image is represented
by a |canavs| element child with the class |overlay|.  An element has
*width* and *height*.  The element's width, the element's base image's
width, and the element's overlay image's width are initially set to
the same value.  The element's height, the element's base image's
height, and the element's overlay image's height are initially set to
the same value.

When an image is *selected* for the element, the selected image is set
to the overlay image, the element's width is set to the image's
width. and the element's height is set to the image's height.

Once an image is selected for the element, the element *has an image*.
While an element has an image, the element has the |has-image| class.
While the element has no image, the user can click the element to open
a user interface to select a image (i.e. manually invoking the
|selectImageFromFile| method).  In this state, the |clickmode|
attribute of the element is set to |selectImage|.  In addition, the
user can drop an image file to the element.  When the user is dragging
an image file over the element, the |drop-target| class is set to the
element.

There are these object properties:

  height

    The element's height, in pixels.

  width

    The element's width, in pixels.

There are these methods:

  selectImageByURL (url : String) : Promise

    Selects an image specified by the URL /url/ for the element.  It
    returns a promise which is fulfilled once the image has been
    loaded.  It is rejected if the image cannot be loaded.

  selectImageFromFile () : Promise

    Selects an image for the element by showing a user interface to
    choose a file.  It returns a promise which is fulfilled once the
    image has been loaded.  It is rejected if the image cannot be
    loaded.  This is a |command-button| command.

  startCaptureMode ()

    Starts the element's *camera capture mode*, if not yet and if
    possible.  While the element is in the camera capture mode, a
    |video| element with class |capture| is inserted in the element.
    This is a |command-button| command.

  endCaptureMode ()

    Ends the element's camera capture mode, if the element is in that
    mode.  This is a |command-button| command.

  selectImageFromCaptureModeAndEndCaptureMode () : Promise

    Selects the current snapshot of the camera for the element.  It
    returns a promise which is fulfilled once the image has been
    loaded.  It is rejected if the image cannot be loaded.  It
    implicitly invokes |endCaptureMode| after selection.  This is a
    |command-button| command.

  getPNGBlob () : Promise

    Serializes the element as a PNG file.  It returns a promise which
    is fulfilled with a Blob of that file.

  getJPEGBlob () : Promise

    Serializes the element as a JPEG file.  It returns a promise which
    is fulfilled with a Blob of that file.

The |resize| event is fired at the element when the element is
initialized and whenever the element's width or height has been
changed.  Note that the event is not fired when an image is selected
for the element but both width and height are unchanged.

The |change| event is fired at the element when the element is
initialized and whenever an image is selected for the element.

* Author

Wakaba <wakaba@suikawiki.org>.

* License

Copyright 2017 Wakaba <wakaba@suikawiki.org>.

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Affero General Public License for more details.

You does not have received a copy of the GNU Affero General Public
License along with this program, see <https://www.gnu.org/licenses/>.
