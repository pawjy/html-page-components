<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Test</title>
  <style>
    map-area {
      width: 977px !important;
    }
  </style>
</head>
<body id=for-screenshot>
  
  <test-code name="map-area setMapType">
    /*
      <map-area engine=maplibre gsi></map-area>
    */
    var e = this.currentScript.querySelector ('map-area');

    await e.ready;

    e.setMapType ('gsi-photo');

    await this.wait (500);

    var pos = e.getMapCenter ();
    this.assert.equal (pos.lat, 0);
    this.assert.equal (pos.lon, 0);

    var d = e.querySelector ('details[is=pc-map-credit-details]');
    this.assert.equal (!!d.offsetWidth, true, d.offsetWidth);
    this.assert.equal (!!d.offsetHeight, true, d.offsetHeight);

    this.assert.equal (e.pcMapType, 'gsi-photo');

    e.setAttribute ('maptype', 'gsi-english');

    await this.wait (100);

    this.assert.equal (e.pcMapType, 'gsi-english');
  </test-code>
  
  <test-code name="map-area maptype=''">
    /*
      <map-area engine=maplibre gsi maptype=gsi-photo></map-area>
    */
    var e = this.currentScript.querySelector ('map-area');

    await e.ready;

    var pos = e.getMapCenter ();
    this.assert.equal (pos.lat, 0);
    this.assert.equal (pos.lon, 0);

    await this.wait (100);

    var d = e.querySelector ('details[is=pc-map-credit-details]');
    this.assert.equal (!!d.offsetWidth, true, d.offsetWidth);
    this.assert.equal (!!d.offsetHeight, true, d.offsetHeight);

    this.assert.equal (e.pcMapType, 'gsi-photo');

    e.setAttribute ('maptype', 'gsi-english');

    await this.wait (100);

    this.assert.equal (e.pcMapType, 'gsi-english');
  </test-code>

  <test-code name="map-area jma">
    /*
      <map-area engine=maplibre lat=20.33 lon=-120.7013 controls jma lang=ja></map-area>
    */
    var e = this.currentScript.querySelector ('map-area');
    await e.ready;

    var m = e.querySelector ('popup-menu');
    this.assert.equal (!!m.offsetWidth, true, 'menu shown');
    m.querySelector ('button').click ();

    await this.wait ();
    var input = e.querySelector ('input[type=checkbox]');
    this.assert.equal (input.parentNode.querySelector ('span').textContent, '雨雲の動き');

    input.click ();
    await this.wait (100);
    
    var ts = e.querySelector ('.paco-jma-timestamp-control');
    this.assert.equal (!!ts.offsetWidth, true);
    this.assert.equal (!!ts.querySelector ('time').textContent, true);
    this.assert.equal (ts.querySelector ('time').getAttribute ('tzoffset'), null);
  </test-code>

  <test-code name="map-area gsi jma">
    /*
      <map-area engine=maplibre lat=20.33 lon=-120.7013 controls gsi jma lang=ja></map-area>
    */
    var e = this.currentScript.querySelector ('map-area');
    await e.ready;

    var m = e.querySelector ('popup-menu');
    this.assert.equal (!!m.offsetWidth, true, 'menu shown');
    m.querySelector ('button').click ();

    await this.wait ();
    var input = e.querySelector ('input[type=checkbox][value=rain]');
    this.assert.equal (input.parentNode.querySelector ('span').textContent, '雨雲の動き');

    input.click ();
    await this.wait (100);

    var ts = e.querySelector ('.paco-jma-timestamp-control');
    this.assert.equal (!!ts.offsetWidth, true);
    this.assert.equal (!!ts.querySelector ('time').textContent, true);
    this.assert.equal (ts.querySelector ('time').getAttribute ('tzoffset'), null);
  </test-code>

  <test-code name="map-area gsi osm">
    /*
      <map-area engine=maplibre lat=20.33 lon=-120.7013 controls gsi osm lang=ja></map-area>
    */
    var e = this.currentScript.querySelector ('map-area');
    await e.ready;

    var m = e.querySelector ('popup-menu');
    this.assert.equal (!!m.offsetWidth, true, 'menu shown');
    m.querySelector ('button').click ();
    await this.wait (100);
    
    let b = m.querySelector ('menu-item popup-menu:has(.paco-map-menu-main) button');
    b.click ();
    await this.wait (200);

    let c = m.querySelector ('button[data-false=osm]');
    this.assert.equal (!!c.offsetWidth, true, 'osm button shown');
    c.click ();
    await this.wait (300);

    let link = e.querySelector ('.maplibregl-ctrl-attrib a[href*=openstreetmap]');
    this.assert.equal (!!link.offsetWidth, true);
    this.assert.equal (link.textContent, 'OpenStreetMap');
  </test-code>

  <test-code name="terrain">
    /*
      <map-area engine=maplibre maptype=gsi-photo-optimal_bvmap pitch=35 terrain gsi jma osm lat=35.2 lon=135.4 zoom=12></map-area>
    */
    var e = this.currentScript.querySelector ('map-area');
    await e.ready;
    await this.wait ();

    {
      let m = e.getMapCenter ();
      this.assert.equal (Math.abs (m.lat - 35.2) < 0.01, true, m.lat);
    }
  </test-code>
  
  <script src=runtests.js data-maps></script>
</body>
</html>
<!--

Per CC0 <https://creativecommons.org/publicdomain/zero/1.0/>, to the
extent possible under law, the author has waived all copyright and
related or neighboring rights to this work.

-->
